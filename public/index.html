<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceBot Pro - Your AI Financial Advisor</title>
    
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gold: #FFD700;
            --primary-dark: #0a0e1a;
            --secondary-dark: #0f1420;
            --tertiary-dark: #1a1f2e;
            --border-color: #2a3142;
            --text-primary: #e0e6ed;
            --text-secondary: #9ca3af;
            --success: #22c55e;
            --danger: #ef4444;
            --info: #3b82f6;
            --chart-green: #00ff88;
            --chart-red: #ff3366;
            
            /* Disclaimer theme colors */
            --disclaimer-bg: #1A1A1A;
            --disclaimer-text: #B0B0B0;
            --disclaimer-border: #333333;
            --disclaimer-hover: #2A2A2A;
        }

        /* Light mode disclaimer colors (auto-detect system preference) */
        @media (prefers-color-scheme: light) {
            :root {
                --disclaimer-bg: #F5F5F5;
                --disclaimer-text: #4A4A4A;
                --disclaimer-border: #DDDDDD;
                --disclaimer-hover: #EEEEEE;
            }
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-dark);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* Layout */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }

        /* Desktop Market Header */
        .desktop-market-header {
            background: var(--secondary-dark);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            z-index: 100;
        }

        .desktop-market-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo-compact {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-gold);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-gold), #ffed4e);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }

        .market-ticker {
            flex: 1;
            margin: 0 24px;
            overflow: hidden;
            height: 32px;
            display: flex;
            align-items: center;
        }

        .market-ticker-content {
            display: flex;
            gap: 24px;
            animation: tickerScroll 30s linear infinite;
            white-space: nowrap;
        }

        @keyframes tickerScroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .ticker-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .ticker-symbol {
            color: var(--primary-gold);
            font-weight: 600;
        }

        .ticker-price {
            color: var(--text-primary);
        }

        .ticker-change {
            font-size: 12px;
        }

        .ticker-change.positive {
            color: var(--success);
        }

        .ticker-change.negative {
            color: var(--danger);
        }

        .market-toggle-desktop {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .market-toggle-desktop:hover {
            background: var(--primary-gold);
            color: var(--primary-dark);
        }

        .market-card {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .market-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-gold), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .market-card:hover::before {
            transform: translateX(100%);
        }

        .market-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .market-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .market-card-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .market-card-symbol {
            font-size: 12px;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.05);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .market-card-price {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .market-card-change {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 500;
        }

        .market-card-change.positive {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }

        .market-card-change.negative {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .market-mini-chart {
            margin-top: 12px;
            height: 40px;
            display: flex;
            align-items: flex-end;
            gap: 2px;
        }

        .chart-bar {
            flex: 1;
            background: var(--border-color);
            border-radius: 2px 2px 0 0;
            transition: all 0.3s ease;
            min-height: 4px;
        }

        .chart-bar.positive {
            background: var(--success);
        }

        .chart-bar.negative {
            background: var(--danger);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--primary-dark);
            width: 100%;
        }

        /* Chat Header */
        .chat-header {
            background: var(--secondary-dark);
            padding: 20px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .chat-title {
            font-size: 20px;
            font-weight: 600;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
            font-size: 12px;
            color: var(--success);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Chat Container - FORCE SCROLLABLE OVERRIDE */
        .chat-container {
            flex: 1 !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            padding: 32px !important;
            padding-bottom: 140px !important; /* Account for input area + disclaimer bar */
            scroll-behavior: smooth !important;
            height: calc(100vh - 80px) !important; /* Full height minus header */
            max-height: calc(100vh - 80px) !important;
            position: relative !important;
        }

        .chat-container::-webkit-scrollbar {
            width: 10px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: var(--secondary-dark);
            border-radius: 5px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 5px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #3a4152;
        }

        /* Welcome Screen */
        .welcome-screen {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px;
            text-align: center;
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-title {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary-gold), #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 20px;
            color: var(--text-secondary);
            margin-bottom: 48px;
            line-height: 1.6;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 48px;
        }

        .feature-card {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            text-align: left;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .feature-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-gold);
        }

        .feature-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .quick-start-section {
            margin-top: 48px;
        }

        .quick-start-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .quick-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-action-btn {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 12px 24px;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-action-btn:hover {
            background: var(--primary-gold);
            color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }

        /* Messages */
        .message {
            margin-bottom: 24px;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-wrapper {
            display: flex;
            gap: 12px;
            max-width: 900px;
        }

        .message.user .message-wrapper {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--primary-gold), #ffed4e);
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
        }

        .message-content {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px 20px;
            font-size: 15px;
            line-height: 1.6;
            position: relative;
        }

        /* Enhanced Bot Response Styling */
        .bot-response-section {
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--primary-gold);
        }

        .bot-response-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--primary-gold);
            font-size: 16px;
        }

        .bot-response-content {
            color: var(--text-primary);
            line-height: 1.7;
        }

        .bot-response-content ul {
            margin: 12px 0;
            padding-left: 20px;
        }

        .bot-response-content li {
            margin-bottom: 8px;
            position: relative;
        }

        .bot-response-content li::marker {
            color: var(--primary-gold);
        }

        .highlight-metric {
            background: rgba(255, 215, 0, 0.15);
            color: var(--primary-gold);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .positive-metric {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .negative-metric {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .info-callout {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            border-left: 4px solid var(--info);
        }

        .warning-callout {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            border-left: 4px solid #f59e0b;
        }

        .success-callout {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            border-left: 4px solid var(--success);
        }

        /* Key Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }

        .metric-card {
            background: var(--secondary-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-2px);
        }

        .metric-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-gold);
        }

        /* Action Items */
        .action-items {
            background: rgba(34, 197, 94, 0.05);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .action-items-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            color: var(--success);
            font-weight: 600;
        }

        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .action-item-icon {
            color: var(--success);
            font-weight: bold;
            margin-top: 2px;
        }

        .action-item-text {
            color: var(--text-primary);
            flex: 1;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--primary-gold), #ffed4e);
            color: var(--primary-dark);
            border: none;
        }

        /* Mobile-Optimized Message Enhancements */
        @media (max-width: 768px) {
            .message {
                margin-bottom: 16px;
            }

            .message-wrapper {
                max-width: 85%;
                gap: 8px;
            }

            .message-avatar {
                width: 32px;
                height: 32px;
                font-size: 16px;
                border-radius: 50%;
            }

            .message-content {
                padding: 12px 16px;
                border-radius: 18px;
                font-size: 14px;
                line-height: 1.5;
            }
        }

        /* Follow-up Questions */
        .follow-up-container {
            margin-top: 12px;
            padding: 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
        }

        .follow-up-prompt {
            font-size: 13px;
            color: var(--info);
            margin-bottom: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .follow-up-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .follow-up-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 8px 12px;
            font-size: 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 32px;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .follow-up-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--info);
            transform: translateY(-1px);
        }

        .follow-up-btn:active {
            transform: translateY(0);
            background: var(--info);
            color: white;
        }

        /* Quick Action Chips for Mobile */
        .quick-actions-mobile {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 16px;
            right: 16px;
            z-index: 100;
        }

        .quick-action-chips {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 4px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .quick-action-chips::-webkit-scrollbar {
            display: none;
        }

        .chip-button {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 44px;
            height: 36px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .chip-button:hover {
            background: var(--border-color);
            border-color: var(--primary-gold);
        }

        .chip-button.active {
            background: var(--primary-gold);
            color: var(--primary-dark);
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .quick-actions-mobile {
                display: block;
            }

            /* Adjust input area to account for quick actions */
            .input-area {
                margin-bottom: 0; /* Remove conflicting margin */
            }
        }

        /* Sliding Market Panel for Mobile */
        .market-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--secondary-dark);
            border-top: 1px solid var(--border-color);
            border-radius: 16px 16px 0 0;
            transform: translateY(calc(100% - 60px));
            transition: transform 0.3s ease;
            z-index: 150;
            display: none;
            max-height: 80vh;
            overflow: hidden;
        }

        .market-panel.active {
            transform: translateY(0);
        }

        .market-panel-handle {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: var(--tertiary-dark);
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .market-panel-handle::before {
            content: '';
            width: 40px;
            height: 4px;
            background: var(--text-secondary);
            border-radius: 2px;
            position: absolute;
            top: 12px;
        }

        .market-panel-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .market-panel-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(80vh - 60px);
        }

        .market-panel-section {
            margin-bottom: 24px;
        }

        .market-panel-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .market-panel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .compact-market-card {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .compact-market-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-2px);
        }

        .compact-market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .compact-market-symbol {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-gold);
        }

        .compact-market-name {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .compact-market-price {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .compact-market-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .compact-market-change.positive {
            color: var(--success);
        }

        .compact-market-change.negative {
            color: var(--danger);
        }

        @media (max-width: 768px) {
            .market-panel {
                display: block;
            }

            .compact-market-card {
                min-height: 80px;
            }
        }

        /* Market Panel Toggle Button */
        .market-toggle-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 48px;
            height: 48px;
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 160;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .market-toggle-btn:hover {
            background: var(--primary-gold);
            color: var(--primary-dark);
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .market-toggle-btn {
                display: flex;
            }
        }

        /* Bottom Navigation for Mobile */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--secondary-dark);
            border-top: 1px solid var(--border-color);
            display: none;
            z-index: 90;
            height: 60px;
        }

        .bottom-nav-content {
            display: flex;
            align-items: center;
            justify-content: space-around;
            height: 100%;
            max-width: 400px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
            border-radius: 8px;
        }

        .bottom-nav-item:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .bottom-nav-item.active {
            background: rgba(255, 215, 0, 0.2);
        }

        .bottom-nav-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }

        .bottom-nav-label {
            font-size: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .bottom-nav-item.active .bottom-nav-label {
            color: var(--primary-gold);
        }

        @media (max-width: 768px) {
            .bottom-nav {
                display: block;
            }

            /* Adjust input area position for mobile with bottom nav */
            .input-area {
                bottom: 120px; /* Above bottom nav (60px) + disclaimer (56px mobile) + spacing */
            }

            /* Adjust chat container for both input area and bottom nav */
            .chat-container {
                padding-bottom: 180px !important; /* Account for input area + bottom nav + disclaimer */
            }

            .fab {
                bottom: 220px;
            }

            .fab-menu {
                bottom: 220px;
            }

            .market-toggle-btn {
                bottom: 170px;
            }

            .quick-actions-mobile {
                bottom: 180px;
            }
        }

        /* Hide bottom nav when market panel is open */
        .market-panel.active ~ .bottom-nav {
            transform: translateY(100%);
        }

        /* Chart Container - IMPROVED */
        .chart-container {
            background: var(--secondary-dark);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .chart-container canvas {
            max-height: 400px !important;
        }

        /* Remove old ASCII chart styles */
        .ascii-chart, pre {
            display: none !important;
        }

        /* Table styles */
        .data-table {
            background: var(--secondary-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 16px 0;
            overflow: hidden;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background: var(--tertiary-dark);
            font-weight: 600;
        }

        /* ============= TRADING DISCLAIMER STYLES ============= */
        
        /* Disclaimer Bar - Sticky Footer */
        .disclaimer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--disclaimer-bg);
            border-top: 1px solid var(--disclaimer-border);
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            font-size: 12px;
            color: var(--disclaimer-text);
            font-weight: 400;
            transition: height 0.3s ease;
        }

        .disclaimer-content {
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 1200px;
            width: 100%;
            padding: 0 20px;
        }

        .disclaimer-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--disclaimer-text);
            color: var(--disclaimer-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .disclaimer-icon:hover {
            background: var(--info);
            transform: scale(1.1);
        }

        .disclaimer-text {
            flex: 1;
            line-height: 1.3;
        }

        .disclaimer-expand {
            color: var(--info);
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s ease;
            font-size: 11px;
        }

        .disclaimer-expand:hover {
            color: var(--primary-gold);
        }

        /* Expanded Disclaimer */
        .disclaimer-bar.expanded {
            height: auto;
            min-height: 48px;
            max-height: 300px;
            overflow-y: auto;
        }

        .disclaimer-details {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--disclaimer-border);
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .disclaimer-bar.expanded .disclaimer-details {
            display: grid;
        }

        .disclaimer-section {
            background: rgba(255, 255, 255, 0.02);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .disclaimer-section h4 {
            color: var(--primary-gold);
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .disclaimer-section p {
            font-size: 11px;
            line-height: 1.4;
            margin-bottom: 8px;
            color: var(--disclaimer-text);
        }

        .disclaimer-section p:last-child {
            margin-bottom: 0;
        }

        .disclaimer-full-link {
            color: var(--info);
            text-decoration: none;
            font-size: 11px;
            margin-top: 16px;
            display: inline-block;
            transition: color 0.2s ease;
        }

        .disclaimer-full-link:hover {
            color: var(--primary-gold);
        }

        /* Onboarding Modal */
        .disclaimer-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 2000;
            animation: modalFadeIn 0.3s ease;
        }

        .disclaimer-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .disclaimer-modal-content {
            background: var(--secondary-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 24px;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(-20px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .disclaimer-modal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .disclaimer-modal-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-gold);
            color: var(--primary-dark);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
        }

        .disclaimer-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .disclaimer-modal-body {
            margin-bottom: 24px;
        }

        .disclaimer-primary-text {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .disclaimer-sections {
            display: grid;
            gap: 16px;
        }

        .disclaimer-modal-section {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
        }

        .disclaimer-modal-section h4 {
            color: var(--primary-gold);
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .disclaimer-modal-section p {
            font-size: 13px;
            line-height: 1.4;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .disclaimer-modal-section p:last-child {
            margin-bottom: 0;
        }

        .disclaimer-modal-footer {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .disclaimer-checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .disclaimer-checkbox {
            margin-top: 2px;
            accent-color: var(--primary-gold);
            cursor: pointer;
        }

        .disclaimer-checkbox-label {
            font-size: 12px;
            line-height: 1.4;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .disclaimer-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .disclaimer-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            min-height: 44px;
        }

        .disclaimer-btn-secondary {
            background: var(--tertiary-dark);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .disclaimer-btn-secondary:hover {
            background: var(--disclaimer-hover);
            color: var(--text-primary);
        }

        .disclaimer-btn-primary {
            background: var(--primary-gold);
            color: var(--primary-dark);
            font-weight: 600;
        }

        .disclaimer-btn-primary:hover {
            background: #ffed4e;
            transform: translateY(-1px);
        }

        .disclaimer-btn-primary:disabled {
            background: var(--border-color);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .disclaimer-bar {
                height: 56px;
                font-size: 13px;
            }

            .disclaimer-content {
                padding: 0 16px;
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .disclaimer-details {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .disclaimer-modal-content {
                margin: 20px;
                padding: 20px;
            }

            .disclaimer-modal-buttons {
                flex-direction: column;
            }

            .disclaimer-btn {
                width: 100%;
            }
        }

                /* App container adjustment for disclaimer bar */
        .app-container {
            padding-bottom: 48px;
        }

        @media (max-width: 768px) {
            .app-container {
                padding-bottom: 56px;
            }
        }

        .data-table tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        /* Input Area - FORCE CLEAN AND SIMPLE OVERRIDE */
        .input-area {
            background: var(--secondary-dark) !important;
            border-top: 1px solid var(--border-color) !important;
            padding: 12px 16px !important;
            position: fixed !important;
            bottom: 48px !important; /* Above disclaimer bar */
            left: 0 !important;
            right: 0 !important;
            z-index: 1001 !important; /* Above disclaimer */
            box-shadow: none !important;
            border-radius: 0 !important;
            backdrop-filter: none !important;
        }

        .input-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-group {
            flex: 1 !important;
            position: relative !important;
            background: var(--tertiary-dark) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 20px !important;
            padding: 2px !important;
            transition: all 0.2s ease !important;
            box-shadow: none !important;
        }

        .input-group:focus-within {
            border-color: var(--primary-gold) !important;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.1) !important;
            transform: none !important;
            background: var(--tertiary-dark) !important;
        }

        .chat-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-size: 16px;
            padding: 12px 16px;
            resize: none;
            max-height: 120px;
            min-height: 20px;
            line-height: 1.5;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
        }

        .chat-input::placeholder {
            color: var(--text-secondary);
            font-weight: 400;
            font-size: 16px;
        }

        .input-actions {
            display: flex;
            gap: 4px;
            align-items: flex-end;
            padding: 4px;
        }

        .input-btn {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
            border: none;
            font-weight: 400;
        }

        .input-btn:hover {
            background: var(--primary-gold);
            color: var(--primary-dark);
            transform: scale(1.05);
        }

        .file-upload-btn.has-files {
            background: var(--success);
            color: white;
        }

        .file-count-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .send-btn {
            background: var(--primary-gold);
            color: var(--primary-dark);
        }

        .send-btn:hover:not(:disabled) {
            background: #ffed4e;
            transform: scale(1.1) rotate(15deg);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Modern Loading Indicator */
        .typing-indicator {
            display: none;
            padding: 16px 32px;
            margin-bottom: 16px;
        }

        .typing-indicator.active {
            display: flex;
            justify-content: flex-start;
            animation: fadeIn 0.3s ease;
        }

        .typing-bubble {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 18px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .ai-avatar {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #5865f2, #7289da);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .typing-text {
            color: var(--text-secondary);
            font-size: 14px;
            margin-right: 8px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #5865f2;
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% { 
                opacity: 0.3; 
                transform: translateY(0);
            }
            30% { 
                opacity: 1; 
                transform: translateY(-4px);
            }
        }

        /* File Upload Area */
        .file-upload-area {
            margin-bottom: 16px;
            display: none;
        }

        .file-upload-area.active {
            display: block;
        }

        .uploaded-files {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .uploaded-file {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .uploaded-file .remove-btn {
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .uploaded-file .remove-btn:hover {
            color: var(--danger);
        }

        /* Suggestions */
        .suggestions-container {
            margin-top: 16px;
            padding: 16px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
        }

        .suggestions-title {
            font-weight: 600;
            color: var(--info);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .suggestion-item {
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .suggestion-item:hover {
            background: var(--border-color);
            transform: translateX(4px);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
        }

        /* Mobile-First Responsive Design */
        @media (max-width: 768px) {
            /* Hide desktop header on mobile */
            .desktop-market-header {
                display: none;
            }

            /* Compact header for mobile */
            .chat-header {
                padding: 12px 16px;
                border-bottom: 1px solid var(--border-color);
            }

            .chat-title {
                font-size: 18px;
            }

            .status-badge {
                font-size: 12px;
            }

            .chat-header-right {
                display: none; /* Hide "Powered by" text on mobile */
            }

            /* Mobile-optimized chat container - FORCE SCROLLABLE */
            .chat-container {
                padding: 16px 12px !important;
                padding-bottom: 200px !important; /* Account for input area + disclaimer + bottom nav */
                height: calc(100vh - 80px) !important; /* Account for header only */
                max-height: calc(100vh - 80px) !important;
                overflow-y: auto !important;
                overflow-x: hidden !important;
                position: relative !important;
            }

            /* Responsive welcome screen */
            .welcome-title {
                font-size: 28px;
                margin-bottom: 12px;
            }

            .welcome-subtitle {
                font-size: 16px;
                margin-bottom: 24px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                margin-bottom: 32px;
            }

            .feature-card {
                padding: 16px;
            }

            /* Compact quick actions */
            .quick-actions {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                justify-content: center;
            }

            .quick-action-btn {
                padding: 8px 12px;
                font-size: 13px;
                border-radius: 20px;
                min-width: 44px; /* Touch-friendly minimum */
                height: 44px;
                display: flex;
                align-items: center;
                gap: 6px;
                white-space: nowrap;
                flex: 1 1 auto;
                max-width: 140px;
            }

            /* Mobile input area - FORCE CLEAN OVERRIDE */
            .input-area {
                padding: 12px 16px !important;
                background: var(--secondary-dark) !important;
                border-top: 1px solid var(--border-color) !important;
                bottom: 108px !important; /* Above bottom nav (60px) + disclaimer (48px) */
                box-shadow: none !important;
                border-radius: 0 !important;
                backdrop-filter: none !important;
            }

            .input-wrapper {
                max-width: none;
            }

            .chat-input {
                font-size: 16px; /* Prevent zoom on iOS */
                padding: 12px 16px;
                border-radius: 24px;
                font-weight: 400;
                min-height: 20px;
            }

            .input-actions {
                gap: 8px;
            }

            .input-btn {
                width: 48px;
                height: 48px;
                border-radius: 24px;
                font-size: 18px;
            }

            /* Hide mobile menu toggle since sidebar is hidden */
            .mobile-menu-toggle {
                display: none;
            }
        }

        /* Tablet styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .sidebar {
                width: 280px;
            }

            .feature-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Large desktop */
        @media (min-width: 1025px) {
            .sidebar {
                width: 320px;
            }

            .chat-container {
                max-width: 800px;
                margin: 0 auto;
            }
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary-gold), #ffed4e);
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-dark);
            transition: all 0.3s ease;
            z-index: 200;
        }

        .fab:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        .fab.hidden {
            transform: translateY(100px);
            opacity: 0;
        }

        /* Compact Action Menu */
        .fab-menu {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 199;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .fab-menu.active {
            transform: translateY(0);
            opacity: 1;
            pointer-events: all;
        }

        .fab-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--tertiary-dark);
            border: 1px solid var(--border-color);
            border-radius: 28px;
            padding: 8px 16px 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-height: 44px;
        }

        .fab-menu-item:hover {
            background: var(--border-color);
            border-color: var(--primary-gold);
            transform: translateX(-4px);
        }

        .fab-menu-icon {
            width: 28px;
            height: 28px;
            background: var(--primary-gold);
            color: var(--primary-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .fab-menu-text {
            font-size: 13px;
            color: var(--text-primary);
        }



        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* MODERN CHAT INPUT - COMPLETE REPLACEMENT */
        .modern-input-area {
            position: fixed !important;
            bottom: 48px !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1002 !important;
            background: transparent !important;
            padding: 16px 20px !important;
        }
        
        .modern-input-container {
            max-width: 1000px !important;
            margin: 0 auto !important;
        }
        
        .modern-input-field {
            background: #36393f !important;
            border: 2px solid #40444b !important;
            border-radius: 24px !important;
            padding: 4px !important;
            display: flex !important;
            align-items: flex-end !important;
            transition: all 0.2s ease !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }
        
        .modern-input-field:focus-within {
            border-color: #5865f2 !important;
            box-shadow: 0 0 0 1px #5865f2, 0 4px 12px rgba(88,101,242,0.2) !important;
        }
        
        .modern-chat-input {
            flex: 1 !important;
            background: transparent !important;
            border: none !important;
            outline: none !important;
            color: #dcddde !important;
            font-size: 16px !important;
            padding: 12px 16px !important;
            resize: none !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            line-height: 1.4 !important;
            max-height: 144px !important;
            min-height: 20px !important;
        }
        
        .modern-chat-input::placeholder {
            color: #72767d !important;
            font-weight: 400 !important;
        }
        
        .modern-input-actions {
            display: flex !important;
            gap: 8px !important;
            padding: 8px !important;
            align-items: center !important;
        }
        
        .modern-btn {
            width: 32px !important;
            height: 32px !important;
            border-radius: 16px !important;
            border: none !important;
            background: #4f545c !important;
            color: #b9bbbe !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            position: relative !important;
        }
        
        .modern-btn:hover {
            background: #5865f2 !important;
            color: white !important;
            transform: scale(1.05) !important;
        }
        
        .modern-btn.send-btn {
            background: #5865f2 !important;
            color: white !important;
        }
        
        .modern-btn.send-btn:hover {
            background: #4752c4 !important;
            transform: scale(1.1) !important;
        }
        
        .modern-btn:disabled {
            opacity: 0.5 !important;
            cursor: not-allowed !important;
            transform: none !important;
        }

        body .chat-container {
            overflow-y: auto !important;
            overflow-x: hidden !important;
            max-height: calc(100vh - 80px) !important;
            position: relative !important;
        }

        body .main-content {
            display: flex !important;
            flex-direction: column !important;
            height: 100vh !important;
            overflow: hidden !important;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Compact Mode Adjustments */
        @media (max-width: 768px) {
            .fab {
                bottom: 140px;
                right: 16px;
                width: 48px;
                height: 48px;
                font-size: 20px;
            }

            .fab-menu {
                bottom: 140px;
                right: 16px;
            }

            .fab-menu-item {
                padding: 6px 12px 6px 8px;
                border-radius: 24px;
            }

            .fab-menu-icon {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }

            .fab-menu-text {
                font-size: 12px;
            }
        }

        /* Error States */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--danger);
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
        }

        /* Success States */
        .success-message {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleSidebar()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <!-- Desktop Market Overview - Compact Header -->
        <div class="desktop-market-header" id="desktop-market-header">
            <div class="desktop-market-content">
                <div class="logo-compact">
                    <div class="logo-icon">📊</div>
                    <span>FinanceBot Pro</span>
                </div>
                <div class="market-ticker" id="market-ticker">
                    <!-- Live market data will scroll here -->
                </div>
                <div class="market-toggle-desktop" onclick="toggleDesktopMarkets()">
                    <span>📊</span> Markets
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat Header -->
            <header class="chat-header">
                <div class="chat-header-left">
                    <h1 class="chat-title">Chat with Max</h1>
                    <div class="status-badge">
                        <span class="status-dot"></span>
                        <span>AI Advisor Online</span>
                    </div>
                </div>
                <div class="chat-header-right">
                    <span style="font-size: 12px; color: var(--text-secondary);">
                        Powered by Advanced Perplexity AI
                    </span>
                </div>
            </header>

            <!-- Chat Container -->
            <div class="chat-container" id="chat-container">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcome-screen">
                    <h1 class="welcome-title">Welcome to FinanceBot Pro</h1>
                    <p class="welcome-subtitle">
                        Hi! I'm Max, your AI financial advisor powered by institutional-grade analysis. 
                        Let's build your wealth together! 💰
                    </p>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">📈</div>
                            <h3 class="feature-title">Modern Charts</h3>
                            <p class="feature-description">
                                Beautiful, interactive charts powered by Chart.js for clear visualization
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">📊</div>
                            <h3 class="feature-title">Portfolio Analysis</h3>
                            <p class="feature-description">
                                Smart CSV parsing with automatic column detection and validation
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🎯</div>
                            <h3 class="feature-title">Real-Time Data</h3>
                            <p class="feature-description">
                                Live market data with comprehensive research from trusted sources
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">💡</div>
                            <h3 class="feature-title">Smart Insights</h3>
                            <p class="feature-description">
                                AI-powered recommendations with entry/exit points and risk analysis
                            </p>
                        </div>
                    </div>

                    <div class="quick-start-section">
                        <h3 class="quick-start-title">Quick Start</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="sendQuickMessage('Analyze Apple stock with technical indicators')">
                                <span>🍎</span> Apple Analysis
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('Show me Bitcoin price trends with charts')">
                                <span>₿</span> Bitcoin Charts
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('Compare Gold vs Silver performance')">
                                <span>🥇</span> Gold vs Silver
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('What are the best dividend stocks right now?')">
                                <span>💵</span> Dividend Stocks
                            </button>
                            <button class="quick-action-btn" onclick="promptFileUpload()">
                                <span>📁</span> Upload Portfolio
                            </button>
                        </div>
                    </div>
                </div>
            </div>

                <!-- Modern Typing Indicator -->
    <div class="typing-indicator" id="typing-indicator">
        <div class="typing-bubble">
            <div class="ai-avatar">🤖</div>
            <span class="typing-text">Max is thinking</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
    </div>

            <!-- Mobile Quick Actions -->
            <div class="quick-actions-mobile" id="quick-actions-mobile">
                <div class="quick-action-chips" id="quick-action-chips">
                    <button class="chip-button" onclick="sendQuickMessage('What are the best stocks to buy now?')">
                        <span>📈</span> Top Stocks
                    </button>
                    <button class="chip-button" onclick="sendQuickMessage('Show me Bitcoin price analysis')">
                        <span>₿</span> Bitcoin
                    </button>
                    <button class="chip-button" onclick="sendQuickMessage('Portfolio diversification tips')">
                        <span>📊</span> Portfolio
                    </button>
                    <button class="chip-button" onclick="sendQuickMessage('Market news and trends today')">
                        <span>📰</span> News
                    </button>
                    <button class="chip-button" onclick="promptFileUpload()">
                        <span>📁</span> Upload
                    </button>
                </div>
            </div>

            <!-- Modern Input Area -->
            <div class="modern-input-area">
                <div class="modern-input-container">
                    <div class="file-upload-area" id="file-upload-area">
                        <div class="uploaded-files" id="uploaded-files"></div>
                    </div>
                    
                    <div class="modern-input-field">
                        <textarea 
                            id="chat-input" 
                            class="modern-chat-input" 
                            placeholder="Message Max..."
                            onkeydown="handleKeyDown(event)"
                            oninput="autoResize(this)"
                        ></textarea>
                        <div class="modern-input-actions">
                            <input type="file" id="file-input" accept=".csv" multiple style="display: none;">
                            <button class="modern-btn file-btn" id="file-upload-btn" onclick="document.getElementById('file-input').click()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66L9.64 16.2a2 2 0 01-2.83-2.83l8.49-8.49"/>
                                </svg>
                                <span class="file-count-badge" id="file-count" style="display: none;">0</span>
                            </button>
                            <button class="modern-btn send-btn" id="send-btn" onclick="sendMessage()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button class="fab" id="fab" onclick="toggleFabMenu()">
            ⚡
        </button>

        <!-- FAB Menu -->
        <div class="fab-menu" id="fab-menu">
            <div class="fab-menu-item" onclick="sendQuickMessage('What are the best investment opportunities today?'); closeFabMenu()">
                <div class="fab-menu-icon">📈</div>
                <div class="fab-menu-text">Top Investments</div>
            </div>
            <div class="fab-menu-item" onclick="sendQuickMessage('Show me my portfolio performance'); closeFabMenu()">
                <div class="fab-menu-icon">📊</div>
                <div class="fab-menu-text">Portfolio Review</div>
            </div>
            <div class="fab-menu-item" onclick="sendQuickMessage('Latest market news and analysis'); closeFabMenu()">
                <div class="fab-menu-icon">📰</div>
                <div class="fab-menu-text">Market News</div>
            </div>
            <div class="fab-menu-item" onclick="promptFileUpload(); closeFabMenu()">
                <div class="fab-menu-icon">📁</div>
                <div class="fab-menu-text">Upload CSV</div>
            </div>
        </div>

        <!-- Market Panel Toggle Button -->
        <button class="market-toggle-btn" id="market-toggle-btn" onclick="toggleMarketPanel()">
            📊
        </button>

        <!-- Sliding Market Panel -->
        <div class="market-panel" id="market-panel">
            <div class="market-panel-handle" onclick="toggleMarketPanel()">
                <div class="market-panel-title">
                    <span>📊</span>
                    <span>Live Markets</span>
                </div>
            </div>
            <div class="market-panel-content">
                <div class="market-panel-section">
                    <div class="market-panel-section-title">Trending Stocks</div>
                    <div class="market-panel-grid" id="mobile-market-stocks">
                        <!-- Market cards will be dynamically inserted here -->
                    </div>
                </div>
                <div class="market-panel-section">
                    <div class="market-panel-section-title">Cryptocurrencies</div>
                    <div class="market-panel-grid" id="mobile-market-crypto">
                        <!-- Crypto cards will be dynamically inserted here -->
                    </div>
                </div>
                <div class="market-panel-section">
                    <div class="market-panel-section-title">Your Watchlist</div>
                    <div class="market-panel-grid" id="mobile-watchlist">
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary); grid-column: 1 / -1;">
                            <p>No items in watchlist</p>
                            <p style="font-size: 12px; margin-top: 8px;">Ask me about any asset to add it!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav" id="bottom-nav">
            <div class="bottom-nav-content">
                <div class="bottom-nav-item active" id="nav-chat" onclick="setActiveNav('chat')">
                    <div class="bottom-nav-icon">💬</div>
                    <div class="bottom-nav-label">Chat</div>
                </div>
                <div class="bottom-nav-item" id="nav-markets" onclick="setActiveNav('markets'); toggleMarketPanel()">
                    <div class="bottom-nav-icon">📊</div>
                    <div class="bottom-nav-label">Markets</div>
                </div>
                <div class="bottom-nav-item" id="nav-portfolio" onclick="setActiveNav('portfolio'); sendQuickMessage('Show me my portfolio performance')">
                    <div class="bottom-nav-icon">💼</div>
                    <div class="bottom-nav-label">Portfolio</div>
                </div>
                <div class="bottom-nav-item" id="nav-upload" onclick="setActiveNav('upload'); promptFileUpload()">
                    <div class="bottom-nav-icon">📁</div>
                    <div class="bottom-nav-label">Upload</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ GLOBAL STATE ============
        let sessionId = null;
        let conversationHistory = [];
        let uploadedFiles = [];
        let isTyping = false;
        let currentMarketData = {};
        let watchlist = new Set();
        let activeCharts = []; // Track active Chart.js instances

        // ============ FOLLOW-UP QUESTIONS SYSTEM ============
        const followUpQuestions = {
            investment_advice: [
                "Tell me more about the risk levels",
                "What's the minimum investment amount?",
                "Compare this with other options",
                "Show me historical performance"
            ],
            market_analysis: [
                "Explain this trend in detail",
                "What are the main risks here?",
                "When should I consider investing?",
                "Show me similar opportunities"
            ],
            portfolio_review: [
                "How can I improve my returns?",
                "What about diversification strategies?",
                "Show me risk analysis",
                "Suggest rebalancing options"
            ],
            crypto: [
                "What affects this price movement?",
                "Is this a good entry point?",
                "Compare with other cryptocurrencies",
                "What's the long-term outlook?"
            ],
            stocks: [
                "Analyze the company fundamentals",
                "What's the technical outlook?",
                "Any upcoming earnings or events?",
                "Compare with sector peers"
            ],
            general: [
                "Can you explain this simply?",
                "What would you recommend for a beginner?",
                "Are there any alternatives?",
                "What should I watch out for?"
            ]
        };

        // ============ CONVERSATIONAL PERSONALITY ============
        const conversationalResponses = {
            greetings: [
                "Great question! Let me dive into that for you.",
                "I'm excited to help you with this!",
                "Excellent timing on this question!",
                "I've got some interesting insights for you!",
                "Let's explore this together!"
            ],
            encouragement: [
                "You're asking all the right questions!",
                "This is a smart approach to investing.",
                "I can see you're thinking strategically.",
                "Great way to stay informed!",
                "This shows good financial planning."
            ],
            transitions: [
                "Here's what I found for you:",
                "Based on my analysis:",
                "Let me break this down:",
                "From what I'm seeing:",
                "Here's the interesting part:"
            ],
            closings: [
                "Hope this helps guide your decision!",
                "Feel free to ask if you need more details!",
                "I'm here whenever you need more insights!",
                "Let me know if you'd like to explore this further!",
                "Happy to dive deeper into any aspect!"
            ]
        };

        function getRandomResponse(category) {
            const responses = conversationalResponses[category];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function detectQueryCategory(message) {
            const lowerMsg = message.toLowerCase();
            
            if (lowerMsg.includes('portfolio') || lowerMsg.includes('balance') || lowerMsg.includes('diversif')) {
                return 'portfolio_review';
            }
            if (lowerMsg.includes('bitcoin') || lowerMsg.includes('crypto') || lowerMsg.includes('ethereum') || lowerMsg.includes('btc') || lowerMsg.includes('eth')) {
                return 'crypto';
            }
            if (lowerMsg.includes('stock') || lowerMsg.includes('aapl') || lowerMsg.includes('tesla') || lowerMsg.includes('company')) {
                return 'stocks';
            }
            if (lowerMsg.includes('invest') || lowerMsg.includes('buy') || lowerMsg.includes('recommendation')) {
                return 'investment_advice';
            }
            if (lowerMsg.includes('market') || lowerMsg.includes('trend') || lowerMsg.includes('analysis') || lowerMsg.includes('price')) {
                return 'market_analysis';
            }
            
            return 'general';
        }

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize session
            try {
                const response = await fetch('/api/session/init');
                const data = await response.json();
                
                if (data.success) {
                    sessionId = data.sessionId;
                }
            } catch (error) {
                console.error('Failed to initialize session:', error);
                sessionId = 'fallback_' + Date.now();
            }

            // Initialize file upload
            document.getElementById('file-input').addEventListener('change', handleFileSelect);
            
            // Initialize market data
            await updateMarketData();
            setInterval(updateMarketData, 30000);
            
            // Focus input
            document.getElementById('chat-input').focus();
        });

        // ============ MARKET DATA ============
        async function updateMarketData() {
            try {
                console.log('📊 Fetching REAL market data...');
                
                // Fetch real market data from our API
                const response = await fetch('/api/market/overview');
                const result = await response.json();
                
                if (result.success && result.data) {
                    currentMarketData = result.data;
                    updateMarketTicker();
                    console.log('✅ Real market data loaded successfully');
                } else {
                    throw new Error(result.error || 'Failed to fetch market data');
                }
                
            } catch (error) {
                console.error('❌ Failed to update real market data:', error);
                
                // Fallback to simulated data only if API fails
                console.log('🔄 Using fallback market data...');
                const fallbackData = {
                    stocks: [
                        { symbol: 'AAPL', name: 'Apple', price: 182.63, change: 2.14, changePercent: 1.19 },
                        { symbol: 'GOOGL', name: 'Google', price: 142.57, change: -0.82, changePercent: -0.57 },
                        { symbol: 'MSFT', name: 'Microsoft', price: 378.91, change: 5.23, changePercent: 1.40 },
                        { symbol: 'TSLA', name: 'Tesla', price: 201.12, change: -3.45, changePercent: -1.69 }
                    ],
                    crypto: [
                        { symbol: 'BTC', name: 'Bitcoin', price: 43256.78, change: 1234.56, changePercent: 2.94 },
                        { symbol: 'ETH', name: 'Ethereum', price: 2234.56, change: -45.67, changePercent: -2.00 }
                    ],
                    commodities: [
                        { symbol: 'GOLD', name: 'Gold', price: 2042.30, change: 12.40, changePercent: 0.61 }
                    ],
                    lastUpdated: new Date().toISOString()
                };
                
                currentMarketData = fallbackData;
                updateMarketTicker();
            }
        }



        // ============ MESSAGING ============
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            // Clear input
            input.value = '';
            autoResize(input);
            
            // Remove welcome screen if present
            const welcomeScreen = document.getElementById('welcome-screen');
            if (welcomeScreen) {
                welcomeScreen.style.display = 'none';
            }
            
            // Add user message
            addMessage(message, 'user');
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                isTyping = true;
                document.getElementById('send-btn').disabled = true;
                
                const formData = new FormData();
                formData.append('message', message);
                formData.append('sessionId', sessionId);
                
                // Add files if any
                if (uploadedFiles.length > 0) {
                    uploadedFiles.forEach(file => {
                        formData.append('files', file.file);
                    });
                }
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        sessionId: sessionId
                    })
                });
                
                const data = await response.json();
                
                hideTypingIndicator();
                
                if (data.success) {
                    // Handle new structured response format
                    const responseData = data.data || {};
                    addStructuredMessage(responseData, {
                        chart: data.chart,
                        metadata: data.metadata,
                        noFollowUp: data.metadata?.conversational || false
                    });
                    
                    // Clear uploaded files if any
                    if (uploadedFiles.length > 0) {
                        clearUploadedFiles();
                    }
                } else {
                    addMessage(data.error || 'Sorry, something went wrong. Please try again.', 'bot', {
                        isError: true
                    });
                }
            } catch (error) {
                hideTypingIndicator();
                console.error('Chat error:', error);
                addMessage('Connection error. Please check your internet and try again.', 'bot', {
                    isError: true
                });
            } finally {
                isTyping = false;
                document.getElementById('send-btn').disabled = false;
                // Restore input focus
                setTimeout(() => {
                    input.focus();
                }, 100);
            }
        }

        function addMessage(content, type, options = {}) {
            const container = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = 'message-wrapper';
            
            // Add avatar
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            avatarDiv.textContent = type === 'user' ? '👤' : '🤖';
            wrapperDiv.appendChild(avatarDiv);
            
            // Add content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (type === 'bot') {
                // Enhanced conversational formatting
                let enhancedContent = content;
                
                // Add conversational greeting if it's not already conversational
                if (!content.toLowerCase().includes('great') && !content.toLowerCase().includes('excited') && 
                    !content.toLowerCase().includes('happy') && content.length > 100) {
                    enhancedContent = getRandomResponse('greetings') + ' ' + content;
                }
                
                // Process bot message for formatting
                contentDiv.innerHTML = formatBotMessage(enhancedContent);
                
                // Add chart if provided
                if (options.chart) {
                    renderChart(contentDiv, options.chart);
                }
                
                // Add suggestions if present
                if (options.metadata && options.metadata.suggestions) {
                    addSuggestions(contentDiv, options.metadata.suggestions);
                }
                
                // Add follow-up questions for bot messages (but not for greetings)
                if (!options.noFollowUp && !options.metadata?.conversational) {
                    const category = options.category || detectQueryCategory(conversationHistory[conversationHistory.length - 1]?.content || '');
                    addFollowUpQuestions(contentDiv, category);
                }
            } else {
                contentDiv.textContent = content;
                // Store user message for context
                const lastUserMessage = { content: content, timestamp: Date.now() };
                conversationHistory.push(lastUserMessage);
            }
            
            wrapperDiv.appendChild(contentDiv);
            messageDiv.appendChild(wrapperDiv);
            container.appendChild(messageDiv);
            
            // Hide welcome screen when first message appears
            const welcomeScreen = document.getElementById('welcome-screen');
            if (welcomeScreen) {
                welcomeScreen.style.display = 'none';
            }
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function addFollowUpQuestions(containerDiv, category) {
            const questions = followUpQuestions[category] || followUpQuestions.general;
            
            // Create follow-up container
            const followUpDiv = document.createElement('div');
            followUpDiv.className = 'follow-up-container';
            
            // Add prompt
            const promptDiv = document.createElement('div');
            promptDiv.className = 'follow-up-prompt';
            promptDiv.innerHTML = '🤔 <span>You might also want to know:</span>';
            followUpDiv.appendChild(promptDiv);
            
            // Add buttons container
            const buttonsDiv = document.createElement('div');
            buttonsDiv.className = 'follow-up-buttons';
            
            // Add up to 3 follow-up questions
            questions.slice(0, 3).forEach(question => {
                const button = document.createElement('button');
                button.className = 'follow-up-btn';
                button.textContent = question;
                button.onclick = () => sendFollowUpQuestion(question);
                buttonsDiv.appendChild(button);
            });
            
            followUpDiv.appendChild(buttonsDiv);
            containerDiv.appendChild(followUpDiv);
        }

        function sendFollowUpQuestion(question) {
            const input = document.getElementById('chat-input');
            input.value = question;
            autoResize(input);
            sendMessage();
        }

        function addStructuredMessage(data, options = {}) {
            const container = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = 'message-wrapper';
            
            // Add avatar
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            avatarDiv.textContent = '🤖';
            wrapperDiv.appendChild(avatarDiv);
            
            // Add structured content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            // Build structured response
            let html = '';
            
            // Conversational greeting
            if (data.greeting) {
                html += `<div style="background: rgba(34, 197, 94, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid var(--success);">`;
                html += `<span style="color: var(--success); font-weight: 500;">💬 ${data.greeting}</span>`;
                html += '</div>';
            }
            
            // Title
            if (data.title) {
                html += `<h3 style="margin-bottom: 12px; color: var(--primary-gold);">${data.title}</h3>`;
            }
            
            // Summary (key points)
            if (data.summary && data.summary.length > 0) {
                html += '<div style="background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 16px; border-left: 3px solid var(--info);">';
                html += '<strong style="color: var(--info);">📋 Quick Summary</strong><br>';
                data.summary.forEach(point => {
                    html += `• ${point}<br>`;
                });
                html += '</div>';
            }
            
            // Key metrics (highlighted)
            if (data.keyMetrics && Object.keys(data.keyMetrics).length > 0) {
                html += '<div class="metrics-grid">';
                Object.entries(data.keyMetrics).forEach(([key, value]) => {
                    if (value) {
                        html += `
                            <div class="metric-card">
                                <div class="metric-label">${key.replace(/([A-Z])/g, ' $1').trim()}</div>
                                <div class="metric-value">${value}</div>
                            </div>
                        `;
                    }
                });
                html += '</div>';
            }
            
            // Sections (detailed analysis)
            if (data.sections && data.sections.length > 0) {
                data.sections.forEach(section => {
                    const sectionIcon = getSectionIcon(section.type);
                    html += `<div class="bot-response-section">`;
                    html += `<div class="bot-response-header"><span>${sectionIcon}</span> ${section.title}</div>`;
                    
                    if (section.content && section.content.length > 0) {
                        html += '<div class="bot-response-content"><ul>';
                        section.content.forEach(item => {
                            html += `<li>${formatContent(item)}</li>`;
                        });
                        html += '</ul></div>';
                    }
                    html += '</div>';
                });
            }
            
            // Action items (what to do next)
            if (data.actionItems && data.actionItems.length > 0) {
                html += '<div class="action-items">';
                html += '<div class="action-items-header"><span>🎯</span> Recommended Actions</div>';
                data.actionItems.slice(0, 3).forEach(action => { // Limit to 3 actions
                    html += `<div class="action-item">
                        <span class="action-item-icon">→</span>
                        <span class="action-item-text">${action}</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            // Encouraging closing
            if (data.encouragement) {
                html += '<div style="background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px; margin-top: 16px; border-left: 3px solid var(--primary-gold);">';
                html += `<span style="color: var(--primary-gold); font-weight: 500;">💡 ${data.encouragement}</span>`;
                html += '</div>';
            }
            
            contentDiv.innerHTML = html;
            
            // Add chart if provided
            if (options.chart) {
                renderChart(contentDiv, options.chart);
            }
            
            // Add follow-up questions for structured messages (but not for greetings)
            if (!options.noFollowUp && !options.metadata?.conversational) {
                const category = options.category || detectQueryCategory(conversationHistory[conversationHistory.length - 1]?.content || '');
                addFollowUpQuestions(contentDiv, category);
            }
            
            wrapperDiv.appendChild(contentDiv);
            messageDiv.appendChild(wrapperDiv);
            container.appendChild(messageDiv);
            
            // Hide welcome screen when first message appears
            const welcomeScreen = document.getElementById('welcome-screen');
            if (welcomeScreen) {
                welcomeScreen.style.display = 'none';
            }
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function getSectionIcon(type) {
            const icons = {
                'technical': '📊',
                'risk': '⚠️',
                'actionable': '🎯',
                'general': '📋',
                'portfolio': '💼'
            };
            return icons[type] || '📋';
        }

        function formatContent(content) {
            // Format prices with enhanced styling
            content = content.replace(/\$[\d,]+\.?\d*/g, '<span class="highlight-metric">$&</span>');
            
            // Format percentages with enhanced styling
            content = content.replace(/([+-]?\d+\.?\d*%)/g, (match) => {
                const isPositive = match.startsWith('+') || (!match.startsWith('-') && parseFloat(match) > 0);
                if (isPositive) {
                    return `<span class="positive-metric">📈 ${match}</span>`;
                } else {
                    return `<span class="negative-metric">📉 ${match}</span>`;
                }
            });
            
            return content;
        }

        // ============ DESKTOP TICKER FUNCTIONALITY ============
        function updateMarketTicker() {
            const ticker = document.getElementById('market-ticker');
            if (!ticker || !currentMarketData) return;
            
            const allAssets = [
                ...(currentMarketData.stocks || []),
                ...(currentMarketData.crypto || []),
                ...(currentMarketData.commodities || [])
            ];
            
            const tickerContent = document.createElement('div');
            tickerContent.className = 'market-ticker-content';
            
            allAssets.forEach(asset => {
                const isPositive = asset.change >= 0;
                const tickerItem = document.createElement('div');
                tickerItem.className = 'ticker-item';
                tickerItem.innerHTML = `
                    <span class="ticker-symbol">${asset.symbol}</span>
                    <span class="ticker-price">$${formatPrice(asset.price)}</span>
                    <span class="ticker-change ${isPositive ? 'positive' : 'negative'}">
                        ${isPositive ? '+' : ''}${asset.changePercent.toFixed(2)}%
                    </span>
                `;
                tickerContent.appendChild(tickerItem);
            });
            
            ticker.innerHTML = '';
            ticker.appendChild(tickerContent);
        }

        function toggleDesktopMarkets() {
            // Toggle market panel for desktop
            toggleMarketPanel();
        }

        function formatBotMessage(content) {
            // Remove any ASCII charts
            content = content.replace(/╔═+╗[\s\S]*?╚═+╝/g, '');
            
            // Format headers
            content = content.replace(/^#{1,3}\s+(.+)$/gm, '<h3>$1</h3>');
            content = content.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // Format lists
            content = content.replace(/^• (.+)$/gm, '<li>$1</li>');
            content = content.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');
            
            // Format line breaks
            content = content.replace(/\n/g, '<br>');
            
            // Format prices
            content = content.replace(/\$[\d,]+\.?\d*/g, '<span style="color: var(--primary-gold); font-weight: 600;">$&</span>');
            
            // Format percentages
            content = content.replace(/([+-]?\d+\.?\d*%)/g, (match) => {
                const isPositive = match.startsWith('+') || (!match.startsWith('-') && parseFloat(match) > 0);
                const color = isPositive ? 'var(--success)' : 'var(--danger)';
                return `<span style="color: ${color}; font-weight: 600;">${match}</span>`;
            });
            
            return content;
        }

        function renderTable(container, tableData) {
            if (!tableData || !tableData.headers || !tableData.rows) {
                console.log('Invalid table data');
                return;
            }

            const tableContainer = document.createElement('div');
            tableContainer.className = 'data-table';
            
            // Add table title if available
            if (tableData.title) {
                const titleDiv = document.createElement('div');
                titleDiv.style.cssText = 'text-align: center; font-weight: 600; margin-bottom: 15px; color: var(--primary-gold); font-size: 16px; padding: 10px;';
                titleDiv.textContent = tableData.title;
                tableContainer.appendChild(titleDiv);
            }

            const table = document.createElement('table');
            
            // Create header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            tableData.headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header.charAt(0).toUpperCase() + header.slice(1);
                th.style.cssText = 'background: var(--tertiary-dark); color: var(--primary-gold); padding: 12px; border-bottom: 2px solid var(--border-color);';
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create body
            const tbody = document.createElement('tbody');
            tableData.rows.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.style.cssText = index % 2 === 0 ? 'background: var(--secondary-dark);' : 'background: var(--tertiary-dark);';
                
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    td.style.cssText = 'padding: 10px 12px; border-bottom: 1px solid var(--border-color); color: var(--text-primary);';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            
            table.style.cssText = 'width: 100%; border-collapse: collapse; border-radius: 8px; overflow: hidden;';
            tableContainer.appendChild(table);
            container.appendChild(tableContainer);
        }

        function renderChart(container, chartData) {
            if (!chartData) {
                console.log('No chart data provided');
                return;
            }

            // Handle tables differently than charts
            if (chartData.type === 'table') {
                renderTable(container, chartData);
                return;
            }

            if (!chartData.data) {
                console.log('No chart data provided');
                return;
            }
            
            // Create chart container with title
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            
            // Add chart title if available
            if (chartData.title) {
                const titleDiv = document.createElement('div');
                titleDiv.style.cssText = 'text-align: center; font-weight: 600; margin-bottom: 15px; color: var(--primary-gold); font-size: 16px;';
                titleDiv.textContent = chartData.title;
                chartContainer.appendChild(titleDiv);
            }
            
            // Create canvas with proper sizing
            const canvas = document.createElement('canvas');
            canvas.style.cssText = 'max-height: 400px; width: 100%;';
            chartContainer.appendChild(canvas);
            container.appendChild(chartContainer);
            
            // Cleanup old charts if too many
            if (activeCharts.length > 5) {
                const oldChart = activeCharts.shift();
                if (oldChart) oldChart.destroy();
            }
            
            try {
                // Create new chart with improved options
                const ctx = canvas.getContext('2d');
                
                // Default chart options with proper theming
                const defaultOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { 
                                color: '#e0e6ed',
                                font: { size: 12 },
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 20, 32, 0.9)',
                            titleColor: '#FFD700',
                            bodyColor: '#e0e6ed',
                            borderColor: '#FFD700',
                            borderWidth: 1
                        }
                    },
                    scales: chartData.type !== 'doughnut' && chartData.type !== 'pie' ? {
                        x: {
                            ticks: { color: '#9ca3af', font: { size: 10 } },
                            grid: { color: '#2a3142' },
                            border: { color: '#2a3142' }
                        },
                        y: {
                            ticks: { color: '#9ca3af', font: { size: 10 } },
                            grid: { color: '#2a3142' },
                            border: { color: '#2a3142' }
                        }
                    } : {}
                };
                
                // Merge with provided options
                const finalOptions = chartData.options ? 
                    { ...defaultOptions, ...chartData.options } : defaultOptions;
                
                const chart = new Chart(ctx, {
                    type: chartData.type || 'line',
                    data: chartData.data,
                    options: finalOptions
                });
                
                activeCharts.push(chart);
                console.log('Chart rendered successfully:', chartData.title || chartData.type);
                
            } catch (error) {
                console.error('Error rendering chart:', error);
                // Show error message in chart container
                chartContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--danger);">
                        📊 Chart temporarily unavailable
                        <br><small>Error: ${error.message}</small>
                    </div>
                `;
            }
        }

        function showTypingIndicator() {
            document.getElementById('typing-indicator').classList.add('active');
            const container = document.getElementById('chat-container');
            container.scrollTop = container.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typing-indicator').classList.remove('active');
        }

        // ============ FILE HANDLING ============
        async function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            files.forEach(file => {
                uploadedFiles.push({ file, name: file.name, size: file.size, type: file.type });
            });
            updateFileDisplay();
            event.target.value = '';
        }

        function updateFileDisplay() {
            const fileArea = document.getElementById('file-upload-area');
            const filesContainer = document.getElementById('uploaded-files');
            const fileBtn = document.getElementById('file-upload-btn');
            const fileCount = document.getElementById('file-count');
            
            if (uploadedFiles.length > 0) {
                fileArea.classList.add('active');
                fileBtn.classList.add('has-files');
                fileCount.style.display = 'block';
                fileCount.textContent = uploadedFiles.length;
                
                filesContainer.innerHTML = uploadedFiles.map((file, index) => `
                    <div class="uploaded-file">
                        <span>📄 ${file.name}</span>
                        <span class="remove-btn" onclick="removeFile(${index})">✕</span>
                    </div>
                `).join('');
                
                // Automatically upload files
                uploadFilesToServer();
            } else {
                fileArea.classList.remove('active');
                fileBtn.classList.remove('has-files');
                fileCount.style.display = 'none';
                filesContainer.innerHTML = '';
            }
        }

        async function uploadFilesToServer() {
            if (uploadedFiles.length === 0) return;
            
            const formData = new FormData();
            uploadedFiles.forEach(fileObj => {
                formData.append('files', fileObj.file);
            });
            formData.append('sessionId', sessionId);
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Handle new structured upload response
                    if (data.data) {
                        addStructuredMessage(data.data, {
                            metadata: data.metadata
                        });
                    } else {
                        // Fallback for old format
                        addMessage(data.message, 'bot');
                    }
                } else {
                    // Show error with details
                    let errorMsg = '❌ ' + data.error;
                    if (data.details) {
                        errorMsg += '\n\nDetails:\n• ' + data.details.join('\n• ');
                    }
                    if (data.hint) {
                        errorMsg += '\n\n💡 ' + data.hint;
                    }
                    addMessage(errorMsg, 'bot', { isError: true });
                }
            } catch (error) {
                console.error('Upload error:', error);
                addMessage('Failed to upload files. Please try again.', 'bot', { isError: true });
            }
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileDisplay();
        }

        function clearUploadedFiles() {
            uploadedFiles = [];
            updateFileDisplay();
        }

        function promptFileUpload() {
            document.getElementById('file-input').click();
        }

        // ============ QUICK ACTIONS ============
        function sendQuickMessage(message) {
            const input = document.getElementById('chat-input');
            input.value = message;
            autoResize(input);
            sendMessage();
        }

        function askAboutAsset(asset) {
            sendQuickMessage(`Provide comprehensive analysis of ${asset.name} (${asset.symbol}) including technical indicators, price targets, and risk assessment`);
            
            // Add to watchlist
            watchlist.add(asset.symbol);
            updateMobileWatchlist();
        }

        // ============ MARKET PANEL FUNCTIONS ============
        let marketPanelOpen = false;

        function toggleMarketPanel() {
            const panel = document.getElementById('market-panel');
            marketPanelOpen = !marketPanelOpen;
            
            if (marketPanelOpen) {
                panel.classList.add('active');
                updateMobileMarketData();
            } else {
                panel.classList.remove('active');
            }
        }

        function updateMobileMarketData() {
            // Update mobile market data when panel opens
            const stocksContainer = document.getElementById('mobile-market-stocks');
            const cryptoContainer = document.getElementById('mobile-market-crypto');
            
            stocksContainer.innerHTML = '';
            cryptoContainer.innerHTML = '';
            
            // Render stocks
            if (currentMarketData.stocks) {
                currentMarketData.stocks.forEach(asset => {
                    const card = createCompactMarketCard(asset);
                    stocksContainer.appendChild(card);
                });
            }
            
            // Render crypto
            if (currentMarketData.crypto) {
                currentMarketData.crypto.forEach(asset => {
                    const card = createCompactMarketCard(asset);
                    cryptoContainer.appendChild(card);
                });
            }
            
            updateMobileWatchlist();
        }

        function createCompactMarketCard(asset) {
            const isPositive = asset.change >= 0;
            const card = document.createElement('div');
            card.className = 'compact-market-card';
            card.onclick = () => {
                askAboutAsset(asset);
                toggleMarketPanel(); // Close panel after selection
            };
            
            card.innerHTML = `
                <div class="compact-market-header">
                    <div>
                        <div class="compact-market-symbol">${asset.symbol}</div>
                        <div class="compact-market-name">${asset.name}</div>
                    </div>
                </div>
                <div class="compact-market-price">$${formatPrice(asset.price)}</div>
                <div class="compact-market-change ${isPositive ? 'positive' : 'negative'}">
                    <span>${isPositive ? '↗' : '↘'}</span>
                    <span>${isPositive ? '+' : ''}${asset.change.toFixed(2)} (${isPositive ? '+' : ''}${asset.changePercent.toFixed(2)}%)</span>
                </div>
            `;
            
            return card;
        }

        // ============ WATCHLIST ============

        function updateMobileWatchlist() {
            const container = document.getElementById('mobile-watchlist');
            
            if (watchlist.size === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary); grid-column: 1 / -1;">
                        <p>No items in watchlist</p>
                        <p style="font-size: 12px; margin-top: 8px;">Ask me about any asset to add it!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            // Get watchlist items from current market data
            const allAssets = [
                ...currentMarketData.stocks || [],
                ...currentMarketData.crypto || [],
                ...currentMarketData.commodities || []
            ];
            
            watchlist.forEach(symbol => {
                const asset = allAssets.find(a => a.symbol === symbol);
                if (asset) {
                    const card = createCompactMarketCard(asset);
                    container.appendChild(card);
                }
            });
        }

        // ============ UTILITY FUNCTIONS ============
        function formatPrice(price) {
            if (price >= 10000) {
                return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            } else if (price >= 1) {
                return price.toFixed(2);
            } else {
                return price.toFixed(4);
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            const newHeight = Math.min(textarea.scrollHeight, 120);
            textarea.style.height = newHeight + 'px';
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }



        // ============ FAB MENU FUNCTIONS ============
        let fabMenuOpen = false;

        function toggleFabMenu() {
            const fabMenu = document.getElementById('fab-menu');
            const fab = document.getElementById('fab');
            
            fabMenuOpen = !fabMenuOpen;
            
            if (fabMenuOpen) {
                fabMenu.classList.add('active');
                fab.style.transform = 'rotate(45deg)';
                fab.innerHTML = '✕';
            } else {
                fabMenu.classList.remove('active');
                fab.style.transform = 'rotate(0deg)';
                fab.innerHTML = '⚡';
            }
        }

        function closeFabMenu() {
            const fabMenu = document.getElementById('fab-menu');
            const fab = document.getElementById('fab');
            
            fabMenuOpen = false;
            fabMenu.classList.remove('active');
            fab.style.transform = 'rotate(0deg)';
            fab.innerHTML = '⚡';
        }

        // Close FAB menu when clicking outside
        document.addEventListener('click', (event) => {
            const fab = document.getElementById('fab');
            const fabMenu = document.getElementById('fab-menu');
            
            if (fabMenuOpen && !fab.contains(event.target) && !fabMenu.contains(event.target)) {
                closeFabMenu();
            }
        });

        // Auto-hide FAB when scrolling up on mobile
        let lastScrollTop = 0;
        const fab = document.getElementById('fab');

        window.addEventListener('scroll', () => {
            if (window.innerWidth <= 768) {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    // Scrolling down
                    fab.classList.add('hidden');
                    closeFabMenu();
                } else {
                    // Scrolling up
                    fab.classList.remove('hidden');
                }
                
                                 lastScrollTop = scrollTop;
             }
         });

        // ============ BOTTOM NAVIGATION ============
        function setActiveNav(navType) {
            // Remove active class from all nav items
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            document.getElementById(`nav-${navType}`).classList.add('active');
            
            // Close market panel if it's open (except for markets nav)
            if (navType !== 'markets' && marketPanelOpen) {
                toggleMarketPanel();
            }
            
            // Close FAB menu if it's open
            if (fabMenuOpen) {
                closeFabMenu();
            }
        }

        function addSuggestions(container, suggestions) {
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'suggestions-container';
            
            suggestionsDiv.innerHTML = `
                <div class="suggestions-title">
                    <span>💡</span>
                    <span>Suggested Actions</span>
                </div>
            `;
            
            suggestions.forEach(suggestion => {
                const suggestionItem = document.createElement('div');
                suggestionItem.className = 'suggestion-item';
                suggestionItem.textContent = suggestion;
                suggestionItem.onclick = () => sendQuickMessage(suggestion);
                suggestionsDiv.appendChild(suggestionItem);
            });
            
            container.appendChild(suggestionsDiv);
        }

        // ============ ERROR HANDLING ============
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
    <!-- ============= TRADING DISCLAIMER COMPONENTS ============= -->
    
    <!-- Disclaimer Bar (Sticky Footer) -->
    <div class="disclaimer-bar" id="disclaimer-bar">
        <div class="disclaimer-content">
            <div class="disclaimer-icon" onclick="toggleDisclaimer()" title="Click for more information">
                ⓘ
            </div>
            <div class="disclaimer-text">
                Trading involves risk. Not investment advice.
            </div>
            <span class="disclaimer-expand" onclick="toggleDisclaimer()">See more</span>
        </div>
        
        <!-- Expanded Details -->
        <div class="disclaimer-details">
            <div class="disclaimer-section">
                <h4>Market Data</h4>
                <p>Provided for informational purposes only. May be delayed.</p>
            </div>
            
            <div class="disclaimer-section">
                <h4>Risk Warning</h4>
                <p>Trading stocks, crypto, and commodities involves substantial risk of loss. Past performance does not guarantee future results.</p>
            </div>
            
            <div class="disclaimer-section">
                <h4>No Advice</h4>
                <p>This app does not provide personalized investment advice. Consult a qualified financial advisor for your specific situation.</p>
            </div>
            
            <div class="disclaimer-section">
                <h4>AI Disclosure</h4>
                <p>Analysis may use AI technology. Results should be independently verified.</p>
            </div>
            
            <a href="#full-terms" class="disclaimer-full-link" onclick="showFullDisclaimer()">
                Full Risk Disclosure and Terms
            </a>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div class="disclaimer-modal" id="disclaimer-modal">
        <div class="disclaimer-modal-content">
            <div class="disclaimer-modal-header">
                <div class="disclaimer-modal-icon">⚠</div>
                <h2 class="disclaimer-modal-title">Important Disclaimer</h2>
            </div>
            
            <div class="disclaimer-modal-body">
                <div class="disclaimer-primary-text">
                    This app provides market data and analysis tools for informational purposes only. It does not constitute investment advice. Trading involves substantial risk of loss and is not suitable for all investors. You could lose all or substantially all of your investment.
                </div>
                
                <div class="disclaimer-sections">
                    <div class="disclaimer-modal-section">
                        <h4>Market Data</h4>
                        <p>Market data may be delayed. Verify current prices before trading.</p>
                    </div>
                    
                    <div class="disclaimer-modal-section">
                        <h4>Portfolio Analysis</h4>
                        <p>Portfolio analysis is based on historical data and hypothetical calculations. Actual results may vary significantly.</p>
                    </div>
                    
                    <div class="disclaimer-modal-section">
                        <h4>Cryptocurrency Risk</h4>
                        <p>Cryptocurrency is highly volatile and unregulated in some jurisdictions. Not protected by traditional investor protections.</p>
                    </div>
                    
                    <div class="disclaimer-modal-section">
                        <h4>AI Technology</h4>
                        <p>Analysis may use AI technology. Results should be independently verified before making any investment decisions.</p>
                    </div>
                </div>
            </div>
            
            <div class="disclaimer-modal-footer">
                <div class="disclaimer-checkbox-container">
                    <input type="checkbox" id="disclaimer-accept" class="disclaimer-checkbox">
                    <label for="disclaimer-accept" class="disclaimer-checkbox-label">
                        I understand and accept the risks associated with trading and financial analysis. I acknowledge this is not personalized investment advice.
                    </label>
                </div>
                
                <div class="disclaimer-modal-buttons">
                    <button class="disclaimer-btn disclaimer-btn-secondary" onclick="window.location.href='https://www.sec.gov/investor/pubs/invrisk.htm'">
                        Learn More About Risks
                    </button>
                    <button class="disclaimer-btn disclaimer-btn-primary" id="disclaimer-accept-btn" onclick="acceptDisclaimer()" disabled>
                        Continue to FinanceBot
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="fix-events.js"></script>
    
    <!-- ============= DISCLAIMER JAVASCRIPT ============= -->
    <script>
        // Disclaimer functionality
        let disclaimerExpanded = false;
        let disclaimerAccepted = false;
        
        // Check if user has already accepted disclaimer
        function checkDisclaimerStatus() {
            const accepted = localStorage.getItem('financebot_disclaimer_accepted');
            disclaimerAccepted = accepted === 'true';
            
            // Show modal on first visit
            if (!disclaimerAccepted) {
                setTimeout(() => {
                    document.getElementById('disclaimer-modal').classList.add('active');
                }, 1000); // Show after 1 second
            }
        }
        
        // Toggle disclaimer expanded state
        function toggleDisclaimer() {
            const disclaimerBar = document.getElementById('disclaimer-bar');
            disclaimerExpanded = !disclaimerExpanded;
            
            if (disclaimerExpanded) {
                disclaimerBar.classList.add('expanded');
                document.querySelector('.disclaimer-expand').textContent = 'See less';
            } else {
                disclaimerBar.classList.remove('expanded');
                document.querySelector('.disclaimer-expand').textContent = 'See more';
            }
        }
        
        // Accept disclaimer and close modal
        function acceptDisclaimer() {
            localStorage.setItem('financebot_disclaimer_accepted', 'true');
            disclaimerAccepted = true;
            document.getElementById('disclaimer-modal').classList.remove('active');
        }
        
        // Show full disclaimer modal
        function showFullDisclaimer() {
            document.getElementById('disclaimer-modal').classList.add('active');
        }
        
        // Handle disclaimer checkbox
        document.addEventListener('DOMContentLoaded', function() {
            const checkbox = document.getElementById('disclaimer-accept');
            const acceptBtn = document.getElementById('disclaimer-accept-btn');
            
            if (checkbox && acceptBtn) {
                checkbox.addEventListener('change', function() {
                    acceptBtn.disabled = !this.checked;
                });
            }
            
            // Check disclaimer status on page load
            checkDisclaimerStatus();
            
            // Add specific disclaimers for different content types
            addContentSpecificDisclaimers();
        });
        
        // Add content-specific disclaimers
        function addContentSpecificDisclaimers() {
            // Override the existing addStructuredMessage function to include disclaimers
            const originalAddStructuredMessage = window.addStructuredMessage;
            
            window.addStructuredMessage = function(data, options = {}) {
                // Call original function
                if (originalAddStructuredMessage) {
                    originalAddStructuredMessage(data, options);
                }
                
                // Add specific disclaimers based on content type
                if (data && data.metadata) {
                    addContextualDisclaimer(data.metadata);
                }
            };
        }
        
        // Add contextual disclaimers based on content
        function addContextualDisclaimer(metadata) {
            let disclaimerText = '';
            
            if (metadata.hasPortfolio) {
                disclaimerText = 'Portfolio analysis is based on historical data and hypothetical calculations.';
            } else if (metadata.hasCrypto) {
                disclaimerText = 'Cryptocurrency is highly volatile and unregulated in some jurisdictions.';
            } else if (metadata.hasChart) {
                disclaimerText = 'Charts are for informational purposes only. Verify data before trading.';
            }
            
            if (disclaimerText) {
                // Add subtle disclaimer to the message
                const chatContainer = document.getElementById('chat-container');
                const lastMessage = chatContainer.lastElementChild;
                
                if (lastMessage && lastMessage.classList.contains('message')) {
                    const disclaimerDiv = document.createElement('div');
                    disclaimerDiv.style.cssText = `
                        font-size: 10px;
                        color: var(--text-secondary);
                        margin-top: 8px;
                        padding: 4px 8px;
                        background: rgba(255, 255, 255, 0.02);
                        border-radius: 4px;
                        border-left: 2px solid var(--disclaimer-border);
                    `;
                    disclaimerDiv.innerHTML = `<em>⚠ ${disclaimerText}</em>`;
                    
                    const messageContent = lastMessage.querySelector('.message-content');
                    if (messageContent) {
                        messageContent.appendChild(disclaimerDiv);
                    }
                }
            }
        }
        
        // Keyboard accessibility for disclaimer
        document.addEventListener('keydown', function(e) {
            // Close modal with Escape key
            if (e.key === 'Escape') {
                const modal = document.getElementById('disclaimer-modal');
                if (modal.classList.contains('active')) {
                    modal.classList.remove('active');
                }
            }
        });
        
        // Click outside modal to close (but only if disclaimer already accepted)
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('disclaimer-modal');
            const modalContent = document.querySelector('.disclaimer-modal-content');
            
            if (modal.classList.contains('active') && 
                disclaimerAccepted && 
                !modalContent.contains(e.target)) {
                modal.classList.remove('active');
            }
        });
    </script>
    
    <!-- CRITICAL OVERRIDE - FORCE CLEAN UI AND SCROLLING -->
    <script>
        // Force clean UI and enable scrolling - IMMEDIATE APPLICATION
        function forceCleanUI() {
            // Create and inject critical override styles
            const forceStyles = document.createElement('style');
            forceStyles.id = 'force-clean-styles';
                         forceStyles.textContent = `
                 .modern-input-area {
                     position: fixed !important;
                     bottom: 48px !important;
                     left: 0 !important;
                     right: 0 !important;
                     z-index: 1002 !important;
                     background: transparent !important;
                     padding: 16px 20px !important;
                 }
                 .modern-input-field {
                     background: #36393f !important;
                     border: 2px solid #40444b !important;
                     border-radius: 24px !important;
                     padding: 4px !important;
                     display: flex !important;
                     align-items: flex-end !important;
                     transition: all 0.2s ease !important;
                     box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                 }
                 .modern-input-field:focus-within {
                     border-color: #5865f2 !important;
                     box-shadow: 0 0 0 1px #5865f2, 0 4px 12px rgba(88,101,242,0.2) !important;
                 }
                 .modern-chat-input {
                     flex: 1 !important;
                     background: transparent !important;
                     border: none !important;
                     outline: none !important;
                     color: #dcddde !important;
                     font-size: 16px !important;
                     padding: 12px 16px !important;
                     resize: none !important;
                     font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                     line-height: 1.4 !important;
                     max-height: 144px !important;
                     min-height: 20px !important;
                 }
                 .modern-chat-input::placeholder {
                     color: #72767d !important;
                     font-weight: 400 !important;
                 }
                 .modern-btn {
                     width: 32px !important;
                     height: 32px !important;
                     border-radius: 16px !important;
                     border: none !important;
                     background: #4f545c !important;
                     color: #b9bbbe !important;
                     cursor: pointer !important;
                     transition: all 0.2s ease !important;
                 }
                 .modern-btn:hover {
                     background: #5865f2 !important;
                     color: white !important;
                     transform: scale(1.05) !important;
                 }
                 .modern-btn.send-btn {
                     background: #5865f2 !important;
                     color: white !important;
                 }
                .chat-container { 
                    overflow-y: auto !important; 
                    overflow-x: hidden !important;
                    max-height: calc(100vh - 80px) !important;
                    position: relative !important;
                }
                .main-content {
                    display: flex !important;
                    flex-direction: column !important;
                    height: 100vh !important;
                    overflow: hidden !important;
                }
            `;
            
            // Remove any existing force styles and add new ones
            const existing = document.getElementById('force-clean-styles');
            if (existing) existing.remove();
            document.head.appendChild(forceStyles);
            
            // Force scroll capability on chat container
            const chatContainer = document.querySelector('.chat-container');
            if (chatContainer) {
                chatContainer.style.setProperty('overflow-y', 'auto', 'important');
                chatContainer.style.setProperty('overflow-x', 'hidden', 'important');
                chatContainer.style.setProperty('max-height', 'calc(100vh - 80px)', 'important');
                chatContainer.style.setProperty('position', 'relative', 'important');
            }
            
            // Force main content to be flex container
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.style.setProperty('display', 'flex', 'important');
                mainContent.style.setProperty('flex-direction', 'column', 'important');
                mainContent.style.setProperty('height', '100vh', 'important');
                mainContent.style.setProperty('overflow', 'hidden', 'important');
            }
        }
        
        // Apply immediately
        forceCleanUI();
        
        // Re-apply on DOM ready and after any page changes
        document.addEventListener('DOMContentLoaded', forceCleanUI);
        
        // Monitor for any style changes and re-apply
        const observer = new MutationObserver(function(mutations) {
            let shouldReapply = false;
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    shouldReapply = true;
                }
            });
            if (shouldReapply) {
                setTimeout(forceCleanUI, 100);
            }
        });
        
        // Start observing
        if (document.body) {
            observer.observe(document.body, {
                attributes: true,
                childList: true,
                subtree: true
            });
        }
    </script>
</body>
</html>